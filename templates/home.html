{% load static %}
{% load timetags %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Django + Stripe Subscriptions</title>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>
  <script src="{% static 'main.js' %}"></script>
</head>

<body>
  <nav class="navbar navbar-light bg-light mb-4">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="{% static 'logo.png' %}" width="50" height="50" class="d-inline-block align-top mr-2" alt="Logo">
        <span class="h3 mb-0">Georgia Auction Alert Archive</span>
      </a>
      {% if request.user.is_authenticated %}
      <span class="navbar-text mr-3">
        Welcome, {{ request.user.username }}
        <button type="button" class="btn btn-info btn-sm ml-2">Alerts</button>
        <a href="{% url 'account_logout' %}" class="btn btn-outline-secondary btn-sm ml-2">Logout</a>
      </span>
      {% endif %}

      {% if not request.user.is_authenticated %}
      <div class="form-inline">
        <span class="navbar-text mr-2">Subscribe for alerts and access to future auctions!</span>
        <a href="{% url 'account_signup' %}" class="btn btn-primary btn-sm">
          Subscribe
        </a>
      </div>
      {% endif %}
    </div>
  </nav>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-6">
        <h4>Auction Listings</h4>
        {% if not can_see_all_files %}
        <div class="alert alert-info">
          You are viewing listings from auctions past.<br>
          {% if request.user.is_authenticated %}
          Subscribe to see upcoming auctions.
          {% else %}
          <a href="/accounts/login/">Login</a> and subscribe to recieve alerts and see upcoming auctions.
          {% endif %}
        </div>
        {% endif %}

        <div class="list-group" style="max-height: 500px; overflow-y: auto;">
          {% for file in files %}
          <a href="{{ file.url }}" class="list-group-item list-group-item-action flex-column align-items-start"
            target="_blank" download>
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">{{ file.name }}</h5>
              <small>{{ file.date }}</small>
            </div>
            {% if file.is_future %}
            <span class="badge badge-success">Future</span>
            {% else %}
            <span class="badge badge-secondary">Past</span>
            {% endif %}
          </a>
          {% empty %}
          <div class="list-group-item">No files found.</div>
          {% endfor %}
        </div>
      </div>

      <div class="col-md-6">
        <div style="color: rgb(80, 80, 80); font-weight: bold; margin-bottom: 20px;">
          Disclamer: Lengthy chain of custody for this data allows this entity to make zero claims to its
          authenticity. Users
          of data obtained from this site agree that it is their responsibility to perform their own due diligence
          before
          attending a tax
          sale. Please consult an
          attorney before investing in tax sales to determine if this level of risk is right for you.
        </div>

        <div class="mb-4">
          {% if request.user.is_authenticated %}
          <img src="{% static '2.png' %}" alt="Logged in image" class="img-fluid">
          {% else %}
          <img src="{% static '1.png' %}" alt="Guest image" class="img-fluid">
          {% endif %}
        </div>

        {% if subscription.status == "active" %}
        <h4>Your subscription:</h4>
        <div class="card" style="width: 18rem;">
          <div class="card-body">
            <h5 class="card-title">{{ product.name }}</h5>
            <p class="card-text">{{ product.description }}</p>
            <p class="card-text">Subscription started from {{ subscription.current_period_start | print_timestamp }}</p>
            <p class="card-text">Subscription ends on {{ subscription.current_period_end | print_timestamp }}</p>
            <a href="{% url 'cancel' %}" class="btn btn-danger mt-3">Cancel Subscription</a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</body>

</html>